---
title: "JuiceFS 的技术架构与读写流程"
date: 2023-04-12 15:03:00
updated: 2023-04-13 00:12:00
categories: [分布式文件系统]
tags: [JuiceFS,分布式文件系统]
---



## 1. JuiceFS 是什么



### 1.1. 简介

JuiceFS 是一款面向云原生设计的分布式文件系统。



JuiceFS 是开源的，开源协议为 Apache 2.0，开源在 [GitHub](https://github.com/juicedata/juicefs) 上。



JuiceFS 提供完备的 POSIX 兼容性，可以将几乎所有的对象存储接入本地作为几乎无限容量的本地磁盘使用。



JuiceFS 也可以同时挂载到不同平台、不同地区的不同主机上进行读写。



JuiceFS 采用「数据」与「元数据」分离存储的架构，从而实现文件系统的分布式设计。文件数据本身会被切分并保存在对象存储（例如 Amazon S3、阿里云 OSS 等），而元数据则可以保存在多种数据库中（例如 Redis、MySQL、TiKV、SQLite 等），用户可以根据场景与性能要求进行选择。



JuiceFS 提供了丰富的 API，适用于各种类型数据的管理、分析、归档、备份。



JuiceFS 可以在不修改代码的前提下无缝对接大数据、机器学习、人工智能等应用平台，提供海量、弹性、低价的高性能存储。



JuiceFS 的运维人员无需为可用性、灾难恢复、监控、扩容等工作烦恼，专注于业务开发，提升研发效率。JuiceFS 的运维非常简单，对 DevOps 非常友好。



### 1.2. 核心特性

JuiceFS 官网给出了以下核心特性：



1. **POSIX 兼容：**像本地文件系统一样使用，无缝对接已有应用，无业务侵入性。
2. **HDFS 兼容：**完整兼容 HDFS API，提供更强的元数据性能。
3. **S3 兼容：**提供 S3 网关 实现 S3 协议兼容的访问接口。
4. **云原生：**通过 Kubernetes CSI 驱动 轻松地在 Kubernetes 中使用 JuiceFS。
5. **分布式设计：**同一文件系统可在上千台服务器同时挂载，高性能并发读写，共享数据。
6. **强一致性：**确认的文件修改会在所有服务器上立即可见，保证强一致性。
7. **强悍性能：**毫秒级延迟，近乎无限的吞吐量（取决于对象存储规模）。
8. **数据安全：**支持传输中加密（encryption in transit）和静态加密（encryption at rest）。
9. **文件锁：**支持 BSD 锁（flock）和 POSIX 锁（fcntl）。
10. **数据压缩：**支持 LZ4 和 Zstandard 压缩算法，节省存储空间。



### 1.3. 应用场景



JuiceFS 为海量数据存储设计，可以作为很多分布式文件系统和网络文件系统的替代，  
特别是以下场景：



- **大数据分析**
  - JuiceFS 与 HDFS 兼容，可以与主流计算引擎（Spark、Presto、Hive 等）无缝衔接。
  - JuiceFS 有无限扩展的存储空间。
  - JuiceFS 的运维成本几乎为 0。
  - JuiceFS 的性能远好于直接对接对象存储。
- **机器学习**
  - JuiceFS 与 POSIX 兼容，可以支持所有机器学习、深度学习框架。
  - JuiceFS 方便的文件共享还能提升团队管理、使用数据效率。
- **Kubernetes**
  - JuiceFS 支持 Kubernetes CSI，为容器提供解耦的文件存储。
  - JuiceFS 令应用服务可以无状态化。
  - JuiceFS 可以方便地在容器间共享数据。
- **共享工作区**
  - JuiceFS 可以在任意主机挂载。
  - JuiceFS 没有客户端并发读写限制。
  - JuiceFS 兼容 POSIX，即兼容已有的数据流和脚本操作。
- **数据备份**
  - JuiceFS 可以在无限平滑扩展的存储空间备份各种数据。
  - JuiceFS 结合共享挂载功能，可以将多主机数据汇总至一处，做统一备份。



## 2. JuiceFS 的技术架构







## 3. JuiceFS 的读写流程

