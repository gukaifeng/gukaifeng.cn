---
title: Raft 论文阅读笔记
date: 2022-04-08 00:47:00
updated: 2022-04-10 13:32:00
categories: [论文阅读笔记]
tags: [Raft,论文,分布式]
---



Raft 论文原文传送门：  
[In Search of an Understandable Consensus Algorithm (Extended Version)](https://raft.github.io/raft.pdf)



> 这篇文章大头是原文翻译，但我在很多地方加入了自己的理解，  
> 主要作为我自己的笔记，不保证读者可以看懂，但你若有问题可以写在评论区，我会回复。



## 0. 摘要



Raft 是一种用于管理复制日志的一致性算法。

Raft 产生的结果和 (multi-)Paxos 一样，并且和 Paxos 一样高效，但是 Raft 的结构和 Paxos 不同。这使 Raft 比 Paxos 更容易理解，也为在构建实际系统提供了更好的基础。

为了更容易理解，Raft 分离了一致性的关键要素，例如领导选举(leader election)，日志复制(log replication)和安全性(safety)。

Raft 加强了一致性，以减少必须考虑的情况的数目。

一个用户研究的结果说明，对于学生来说，Raft 比 Paxos 更容易学。

Raft 还包括一种用于更改集群成员的新机制，该机制使用重叠多数(overlapping majorities)来保证安全。



## 1. 导论



一致性算法允许一组机器作为一个一致的组来工作，这个组能够在其部分成员故障时幸存。因此，在构建可靠的大规模软件系统中，一致性算法扮演着关键的角色。在过去十年间，关于一致性算法的讨论被 Paxos 统治：大部分一致性实现都是基于 Paxos 或受 Paxos 影响的，并且 Paxos 成为了给学生讲关于一致性内容的主要工具。

不幸的是，尽管有数次让 Paxos 更平易近人的尝试，其还是相当难于理解。此外，Paxos 的架构需要复杂的修改以支持实际的系统。结果就是，系统构建者和学生都在为 Paxos 苦苦挣扎。

在我们与 Paxos 斗争之后，我们开始寻找一个新的一致性算法，期望此算法能够为系统构建和教育提供更好的基础。我们的主要目标是**可理解性**，我们的方法不太寻常：我们能否为实际系统定义一个一致性的算法，并且以比 Paxos 容易学得多的方式描述这个算法？此外，我们希望此算法能够促进对系统构建者至关重要的直觉的发展。不仅仅是算法能够工作很重要，能明显看出为什么可以工作也很重要。

这项工作的结果就是一个名为 Raft 的一致性算法。在设计 Raft 过程中，我们应用了特定的技术来提高可理解性，包括分解（Raft 分离了领导选举，日志复制和安全性）和减小状态空间（相对于 Paxos，Raft 降低了非确定性的程度以及服务器之间可能不一致的方式）。一个包含了来自两所大学的 43 个学生的用户研究表明，Raft 比 Paxos 容易理解的多得多：在学习了两个算法以后，33/43 个学生在回答关于 Raft 的问题时比回答关于 Paxos 的问题是表现更好。

Raft 在很多方面都和现存的一致性算法类似（最显著的是，Oki 和 Liskov 的 Viewstamped Replication），但 Raft 有几个新颖的特征：

* **强领导者(Strong leader)：**Raft 使用比其他一致性算法更强大的领导形式。例如，日志条目仅从领导者流向其他服务器。这简化了对复制日志的管理，并使 Raft 更易于理解。
* **领导选举(Leader election)：**Raft 使用随机计时器来选举领导者。这只会为任何一致性算法已经需要的心跳(HeartBeat)添加少量机制，同时简单快速地解决冲突。
* **成员变更(Membership changes)：**Raft 用来变更集群中服务器集合的机制中使用了一个新的方法 — **联合一致性(joint consensus)**，在两个不同的配置中，大部分机器在转换期间重叠，这允许集群在成员变更期间继续正常运行。

不管是以教育为目的，还是作为实现基础，我们都认为 Raft 比 Paxos 和其他一致性算法更好。Raft 比其他一致性算法更简单、更好理解；Raft 的描述足够完整，足以满足实际系统的需要；Raft 有几个开源实现，有几个公司在使用 Raft；Raft 的安全特性已被正式规定和证明；Raft 的效率与其他算法相当。

这篇论文的剩余部分介绍了复制状态机问题（第 2 节），讨论了 Paxos 的优缺点（第 3 节），描述了我们理解可理解性的一般方法（第 4 节），介绍 Raft 一致性算法（第 5-8 节），评估 Raft（第 9 节），最后讨论了相关工作（第 10 节）。



## 2. 复制状态机(Replicated state machines)



一致性算法通常出现在**复制状态机(Replicated state machines)**的上下文中。在这个方法中，服务器集合上的状态机计算同一状态的相同副本，并且即使某些服务器 down 机了也可以继续运行。复制状态机用于解决分布式系统中的各种容错问题。例如，在像 GFS、HDFS 和 RAMCloud 这样的只有单个集群领导者的大规模系统中，通常使用单独的复制状态机来管理领导选举并存储必须在领导者崩溃后幸免的配置信息。在 Chubby 和 ZooKeeper 中有复制状态机的例子。







![图 1：复制状态机架构。一致性算法管理一个复制日志，其中包含来自客户端的状态机命令。这个状态机处理来自日志的相同命令序列，所以它们产生一样的输出。](https://gukaifeng.cn/posts/raft-lun-wen-yue-du-bi-ji/Raft_Figure_1.png)





复制状态机一般使用复制日志实现，如图 1。每个**服务器(Server)**存储一个包含了一系列命令的**日志(Log)**，其**状态机(State Machine)**按顺序执行这些命令。每个日志包含相同顺序的相同命令，所以每个状态机处理相同的命令序列。由于状态机是确定性的，因此每个状态机计算相同的状态和相同的输出序列。

保持复制日志一致是一致性算法的工作。**①** 服务器上的**一致性模型(Consensus Module)**接收来自**客户端(Client)**的命令，**②** 把这些命令添加到服务器的日志中，且和其他服务器上的一致性模型通信以确保每个日志最终包含相同顺序的相同请求，即便一些服务器故障了。一旦命令被正确复制，**③** 每个服务器的状态机都会按日志顺序处理它们，并 ④ 将输出返回给客户端。 结果，服务器似乎形成了一个单一的、高度可靠的状态机

对于实际系统，一致性算法往往有以下属性：





























































































![图 2：Raft 一致性算法的精简摘要（不包括成员变更和日志压缩(compaction)）。](https://gukaifeng.cn/posts/raft-lun-wen-yue-du-bi-ji/Raft_Figure_2.png)
