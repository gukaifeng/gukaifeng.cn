---
title: RocksDB -- DB::Properties 中的属性详解
date: 2022-03-02 16:42:26
updated: 2022-03-02 16:42:26
categories: [数据库]
tags: [RocksDB,数据库]
toc: true
---



RocksDB 中的 DB 类中定义了一个结构体 Properties，里面是许多 RocksDB 的属性。

具体代码在 `db.h` 中，在[这里](https://github.com/facebook/rocksdb/blob/v6.25.3/include/rocksdb/db.h#L748-L987)查看。

结构体 Properties 中的每个成员都对应一个 rocksdb 属性，我们可以通过 `GetProperty()` 或 `GetMapProperty()` 等方法来获取其中的内容。具体方法说明详见 [获取属性值的方法](https://gukaifeng.cn/posts/rocksdb-db-lei/#18-2-获取属性值的方法)。

例如：

```cpp
#include <iostream>
#include <cassert>
#include "rocksdb/db.h"

int main(int argc, char *argv[])
{
    rocksdb::DB *db;
    rocksdb::Options options;
    options.create_if_missing = true;
    rocksdb::Status status =
        rocksdb::DB::Open(options, "./testdb", &db);
    assert(status.ok());
  
    std::string p = "rocksdb.num-files-at-level2";  // 获取该属性值
    std::string v;  // 存储待获取属性值
  
    db->GetProperty(p, &v);  // 执行 GetProperty() 方法
    std::cout << v << std::endl;  // 输出结果

    db->Close();
    delete db;

    return 0;
}
```

上面的代码演示了获取 rocksdb 属性值的方法之一。

关于示例代码中 `"rocksdb.num-files-at-level2"` 的介绍详见 [1. kNumFilesAtLevelPrefix](https://gukaifeng.cn/posts/rocksdb-db-properties-zhong-de-shu-xing-xiang-jie/#1-kNumFilesAtLevelPrefix)

我这里上面代码执行后的输出如下：

```
3
```

这表示我当前的 rocksdb 数据库 `"./testdb"` 中 level2 中一共有 3 个 sst 文件。

\-

下面我会按照这些属性在源码中的定义顺序来逐个介绍它们，较为复杂的会举例说明。

部分带有类似 `level<N>` 字样的属性中的 `<N>` 表示 level 数，例如 level2。

## 1. kNumFilesAtLevelPrefix

**定义**

```cpp
static const std::string kNumFilesAtLevelPrefix;
```

**属性**

```
rocksdb.num-files-at-level<N>
```

**含义**

表示 `L<N>` 中的全部 sst 文件数。

如 `rocksdb.num-files-at-level2` 表示 level 2 中全部的 sst 文件数。



## 2. kCompressionRatioAtLevelPrefix

**定义**

```cpp
static const std::string kCompressionRatioAtLevelPrefix;
```

**属性**

```
rocksdb.compression-ratio-at-level<N>
```

**含义**

表示 `L<N>` 的数据压缩率。

**数据压缩率 = 未压缩的数据大小 / 压缩后的文件大小**

若 `L<N>` 没有打开的文件，则此属性值为 `"-1.0"`.



## 3. kStats

**定义**

```cpp
static const std::string kStats;
```

**属性**

```
rocksdb.stats
```

**含义**

这是一个多行 string，包含了数据库里的一些数据统计信息。

这个属性其实就是 [5. kCFStats](https://gukaifeng.cn/posts/rocksdb-db-properties-zhong-de-shu-xing-xiang-jie/#5-kCFStats) 和 [8. kDBStats](https://gukaifeng.cn/posts/rocksdb-db-properties-zhong-de-shu-xing-xiang-jie/#8-kDBStats) 的组合，内容是一模一样的，所以我们在下面具体的属性内专门再说。



## 4. kSSTables

**定义**

```cpp
static const std::string kSSTables;
```

**属性**

```
rocksdb.sstables
```

**含义**

SST 文件的**简略**信息。是一个多行 stirng。

具体信息形如：

```
--- level 0 --- version# 1 ---
 179:30428945[27533969 .. 28561320]['6B65792D746573743132323430383435' seq:27533969, type:1 .. '6B65792D746573743133323638313936' seq:28561320, type:1](0)
 177:30427512[26506664 .. 27533968]['6B65792D746573743131323133353430' seq:26506664, type:1 .. '6B65792D746573743132323430383434' seq:27533968, type:1](0)
 171:30429788[25479280 .. 26506663]['6B65792D746573743130313836313536' seq:25479280, type:1 .. '6B65792D746573743131323133353339' seq:26506663, type:1](0)
--- level 1 --- version# 1 ---
 328:30430428[84038683 .. 85066084]['6B65792D746573743638373435353539' seq:84038683, type:1 .. '6B65792D746573743639373732393630' seq:85066084, type:1](0)
 335:30430540[87120855 .. 88148260]['6B65792D746573743731383237373331' seq:87120855, type:1 .. '6B65792D746573743732383535313336' seq:88148260, type:1](0)
 357:30431043[94312432 .. 95339856]['6B65792D746573743739303139333038' seq:94312432, type:1 .. '6B65792D746573743830303436373332' seq:95339856, type:1](0)
 393:30429538[106640812 .. 107668185]['6B65792D746573743931333437363838' seq:106640812, type:1 .. '6B65792D746573743932333735303631' seq:107668185, type:1](0)
 408:30428416[110750294 .. 111777630]['6B65792D746573743935343537313730' seq:110750294, type:1 .. '6B65792D746573743936343834353036' seq:111777630, type:1](0)
 410:30427288[111777631 .. 112804925]['6B65792D746573743936343834353037' seq:111777631, type:1 .. '6B65792D746573743937353131383031' seq:112804925, type:1](0)
 412:30429045[112804926 .. 113832282]['6B65792D746573743937353131383032' seq:112804926, type:1 .. '6B65792D746573743938353339313538' seq:113832282, type:1](0)
 414:30430099[113832283 .. 114859673]['6B65792D746573743938353339313539' seq:113832283, type:1 .. '6B65792D746573743939353636353439' seq:114859673, type:1](0)
--- level 2 --- version# 1 ---
 224:30430799[43971552 .. 44998968]['6B65792D746573743238363738343238' seq:43971552, type:1 .. '6B65792D746573743239373035383434' seq:44998968, type:1](0)
 250:30431766[53217472 .. 54244918]['6B65792D746573743337393234333438' seq:53217472, type:1 .. '6B65792D746573743338393531373934' seq:54244918, type:1](0)
 279:30428744[65545776 .. 66573120]['6B65792D746573743530323532363532' seq:65545776, type:1 .. '6B65792D746573743531323739393936' seq:66573120, type:1](0)
 299:30429959[72737469 .. 73764854]['6B65792D746573743537343434333435' seq:72737469, type:1 .. '6B65792D746573743538343731373330' seq:73764854, type:1](0)
--- level 3 --- version# 1 ---
 205:67568579[0 .. 0]['616765' seq:0, type:1 .. '6B65792D746573743134383534363630' seq:0, type:1](0)
 206:67571849[0 .. 0]['6B65792D746573743134383534363631' seq:0, type:1 .. '6B65792D746573743136393235303634' seq:0, type:1](0)
 207:67571499[0 .. 0]['6B65792D746573743136393235303635' seq:0, type:1 .. '6B65792D746573743138393935343538' seq:0, type:1](0)
 208:67571604[0 .. 0]['6B65792D746573743138393935343539' seq:0, type:1 .. '6B65792D746573743231303635383533' seq:0, type:1](0)
 229:67571465[0 .. 0]['6B65792D746573743231303635383534' seq:0, type:1 .. '6B65792D746573743233313336323434' seq:0, type:1](0)
 230:67571526[0 .. 0]['6B65792D746573743233313336323435' seq:0, type:1 .. '6B65792D746573743235323036363338' seq:0, type:1](0)
 231:67571883[0 .. 0]['6B65792D746573743235323036363339' seq:0, type:1 .. '6B65792D746573743237323737303434' seq:0, type:1](0)
 232:46601531[0 .. 0]['6B65792D746573743237323737303435' seq:0, type:1 .. '6B65792D7465737432383935323635' seq:0, type:1](0)
 212:2323202[0 .. 0]['6B65792D7465737432383935323636' seq:0, type:1 .. '6B65792D7465737432393638393531' seq:0, type:1](0)
 245:67572234[0 .. 0]['6B65792D7465737432393638393532' seq:0, type:1 .. '6B65792D746573743331373734363834' seq:0, type:1](0)
 246:67571661[0 .. 0]['6B65792D746573743331373734363835' seq:0, type:1 .. '6B65792D746573743333383435303831' seq:0, type:1](0)
 247:67571687[0 .. 0]['6B65792D746573743333383435303832' seq:0, type:1 .. '6B65792D746573743335393135343830' seq:0, type:1](0)
 248:67568478[0 .. 0]['6B65792D746573743335393135343831' seq:0, type:1 .. '6B65792D7465737433383536303339' seq:0, type:1](0)
 266:67569371[0 .. 0]['6B65792D74657374333835363034' seq:0, type:1 .. '6B65792D746573743430393834333230' seq:0, type:1](0)
 267:67571784[0 .. 0]['6B65792D746573743430393834333231' seq:0, type:1 .. '6B65792D746573743433303534373233' seq:0, type:1](0)
 268:67571390[0 .. 0]['6B65792D746573743433303534373234' seq:0, type:1 .. '6B65792D746573743435313235313133' seq:0, type:1](0)
 284:67571399[0 .. 0]['6B65792D746573743435313235313134' seq:0, type:1 .. '6B65792D746573743437313935353035' seq:0, type:1](0)
 285:67571433[0 .. 0]['6B65792D746573743437313935353036' seq:0, type:1 .. '6B65792D746573743439323635383938' seq:0, type:1](0)
 286:34935606[0 .. 0]['6B65792D746573743439323635383939' seq:0, type:1 .. '6B65792D7465737435313131383931' seq:0, type:1](0)
 295:67569968[0 .. 0]['6B65792D7465737435313131383932' seq:0, type:1 .. '6B65792D746573743533333334373836' seq:0, type:1](0)
 296:67571710[0 .. 0]['6B65792D746573743533333334373837' seq:0, type:1 .. '6B65792D746573743535343035313836' seq:0, type:1](0)
 297:67572538[0 .. 0]['6B65792D746573743535343035313837' seq:0, type:1 .. '6B65792D7465737435373736383037' seq:0, type:1](0)
 311:67569866[0 .. 0]['6B65792D7465737435373736383038' seq:0, type:1 .. '6B65792D746573743630343734313130' seq:0, type:1](0)
 312:67571420[0 .. 0]['6B65792D746573743630343734313131' seq:0, type:1 .. '6B65792D746573743632353434353032' seq:0, type:1](0)
 324:67571553[0 .. 0]['6B65792D746573743632353434353033' seq:0, type:1 .. '6B65792D746573743634363134383938' seq:0, type:1](0)
 325:67571524[0 .. 0]['6B65792D746573743634363134383939' seq:0, type:1 .. '6B65792D746573743636363835323931' seq:0, type:1](0)
 326:67568870[0 .. 0]['6B65792D746573743636363835323932' seq:0, type:1 .. '6B65792D7465737436383834393538' seq:0, type:1](0)
 338:67569102[0 .. 0]['6B65792D7465737436383834393539' seq:0, type:1 .. '6B65792D746573743731373534303936' seq:0, type:1](0)
 339:4675172[0 .. 0]['6B65792D746573743731373534303937' seq:0, type:1 .. '6B65792D7465737437323534383333' seq:0, type:1](0)
 344:67572040[0 .. 0]['6B65792D7465737437323534383334' seq:0, type:1 .. '6B65792D746573743734383935393135' seq:0, type:1](0)
 353:67571702[0 .. 0]['6B65792D746573743734383935393136' seq:0, type:1 .. '6B65792D746573743736393636333135' seq:0, type:1](0)
 354:67569926[0 .. 0]['6B65792D746573743736393636333136' seq:0, type:1 .. '6B65792D7465737437393139383939' seq:0, type:1](0)
 362:67571793[0 .. 0]['6B65792D746573743739313939' seq:0, type:1 .. '6B65792D746573743832303335323534' seq:0, type:1](0)
 368:67571457[0 .. 0]['6B65792D746573743832303335323535' seq:0, type:1 .. '6B65792D746573743834313035363437' seq:0, type:1](0)
 374:67571463[0 .. 0]['6B65792D746573743834313035363438' seq:0, type:1 .. '6B65792D746573743836313736303430' seq:0, type:1](0)
 394:67571676[0 .. 0]['6B65792D746573743836313736303431' seq:0, type:1 .. '6B65792D746573743838323436343430' seq:0, type:1](0)
 395:32616041[0 .. 0]['6B65792D746573743838323436343431' seq:0, type:1 .. '6B65792D746573743839323435373930' seq:0, type:1](0)
 390:67571731[0 .. 0]['6B65792D746573743839323435373931' seq:0, type:1 .. '6B65792D746573743931333136313930' seq:0, type:1](0)
 391:3151837[0 .. 0]['6B65792D746573743931333136313931' seq:0, type:1 .. '6B65792D74657374393230323133' seq:0, type:1](0)
 402:67568957[0 .. 0]['6B65792D7465737439323032313330' seq:0, type:1 .. '6B65792D7465737439343431313231' seq:0, type:1](0)
 406:60561284[0 .. 0]['6B65792D746573743934343131323130' seq:0, type:1 .. '6B657931343735313738' seq:0, type:1](0)
 399:30246517[0 .. 0]['6B657931343735313739' seq:0, type:1 .. '6B657932363632353637' seq:0, type:1](0)
 186:10658951[0 .. 0]['6B657932363632353638' seq:0, type:1 .. '6B657933303830393934' seq:0, type:1](0)
 147:14464394[0 .. 0]['6B657933303830393935' seq:0, type:1 .. '6B657933363438383133' seq:0, type:1](0)
 118:67472947[0 .. 0]['6B657933363438383134' seq:0, type:1 .. '6B657936323937363237' seq:0, type:1](0)
 119:67472916[0 .. 0]['6B657936323937363238' seq:0, type:1 .. '6B6579383934363434' seq:0, type:1](0)
 120:26837417[0 .. 0]['6B657938393436343430' seq:0, type:1 .. '6E616D65' seq:0, type:1](0)
--- level 4 --- version# 1 ---
--- level 5 --- version# 1 ---
--- level 6 --- version# 1 ---
```

可以看到，每个 level 都有描述，即便没有 sst 文件的 levle 4,5,6 中也同样有对应的标题。

我们这里取其中一条来分析：

```
 328:30430428[84038683 .. 85066084]['6B65792D746573743638373435353539' seq:84038683, type:1 .. '6B65792D746573743639373732393630' seq:85066084, type:1](0)
```

这是上面 level 1 的第 1 条信息。

信息一开始的 `328` 表示 sst 文件的编号，你可以在数据库目录里找到对应的 sst 文件，就像下图这样。

![](https://gukaifeng.cn/posts/rocksdb-db-properties-zhong-de-shu-xing-xiang-jie/RocksDB -- DB__Properties 中的属性详解_1.png)



## 5. kCFStats

**定义**

```cpp
static const std::string kCFStats;
```

**属性**

```
rocksdb.cfstats
```

**含义**





## 6. kCFStatsNoFileHistogram

**定义**

```cpp
static const std::string kCFStatsNoFileHistogram;
```

**属性**

```
rocksdb.cfstats-no-file-histogram
```

**含义**





## 7. kCFFileHistogram

**定义**

```cpp
static const std::string kCFFileHistogram;
```

**属性**

```
rocksdb.cf-file-histogram
```

**含义**





## 8. kDBStats

**定义**

```cpp
static const std::string kDBStats;
```

**属性**

```
rocksdb.dbstats
```

**含义**





## 9. kLevelStats

**定义**

```cpp
static const std::string kLevelStats;
```

**属性**

```
rocksdb.levelstats
```

**含义**





## 10. kBlockCacheEntryStats

**定义**

```cpp
static const std::string kBlockCacheEntryStats;
```

**属性**

```
rocksdb.block-cache-entry-stats
```

**含义**





## 11. kNumImmutableMemTable

**定义**

```cpp
static const std::string kNumImmutableMemTable;
```

**属性**

```
rocksdb.num-immutable-mem-table
```

**含义**





## 12. kNumImmutableMemTableFlushed

**定义**

```cpp
static const std::string kNumImmutableMemTableFlushed;
```

**属性**

```
rocksdb.num-immutable-mem-table-flushed
```

**含义**





## 13. kMemTableFlushPending

**定义**

```cpp
static const std::string kMemTableFlushPending;
```

**属性**

```
rocksdb.mem-table-flush-pending
```

**含义**





## 14. kNumRunningFlushes

**定义**

```cpp
static const std::string kNumRunningFlushes;
```

**属性**

```
rocksdb.num-running-flushes
```

**含义**





## 15. kCompactionPending

**定义**

```cpp
static const std::string kCompactionPending;
```

**属性**

```
rocksdb.compaction-pending
```

**含义**





## 16. kNumRunningCompactions

**定义**

```cpp
static const std::string kNumRunningCompactions;
```

**属性**

```
rocksdb.num-running-compactions
```

**含义**





## 17. kBackgroundErrors

**定义**

```cpp
static const std::string kBackgroundErrors;
```

**属性**

```
rocksdb.background-errors
```

**含义**





## 18. kCurSizeActiveMemTable

**定义**

```cpp
static const std::string kCurSizeActiveMemTable;
```

**属性**

```
rocksdb.cur-size-active-mem-table
```

**含义**





## 19. kCurSizeAllMemTables

**定义**

```cpp
static const std::string kCurSizeAllMemTables;
```

**属性**

```
rocksdb.cur-size-all-mem-tables
```

**含义**





## 20. kSizeAllMemTables

**定义**

```cpp
static const std::string kSizeAllMemTables;
```

**属性**

```
rocksdb.size-all-mem-tables
```

**含义**





## 21. kNumEntriesActiveMemTable

**定义**

```cpp
static const std::string kNumEntriesActiveMemTable;
```

**属性**

```
rocksdb.num-entries-active-mem-table
```

**含义**





## 22. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 23. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 24. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 25. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 26. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 27. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 28. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 29. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 30. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 31. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 32. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 33. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 34. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 35. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 36. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 37. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 38. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 39. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 40. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 41. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 42. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 43. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 44. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 45. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 46. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 47. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 48. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 49. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 50. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 51. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 52. 

**定义**

```cpp

```

**属性**

```

```

**含义**





## 53. 

**定义**

```cpp

```

**属性**

```

```

**含义**



